<!DOCTYPE html>
<html>
    <head>
        <style>body { margin: 0px; }</style>

        <script src="lib/crafty-0.7.1.min.js" type="text/javascript"></script>
        <script src="src/prototype/prototype.js" type="text/javascript"></script>

        <script src="src/entities/player.js" type="text/javascript"></script>
        <script src="src/entities/wall.js" type="text/javascript"></script>
        <script src="src/entities/room.js" type="text/javascript"></script>
        <script src="src/entities/map.js" type="text/javascript"></script>
        <script src="src/entities/room-gen.js" type="text/javascript"></script>
        <script src="src/entities/items.js" type="text/javascript"></script>
        <script src="src/entities/darkness.js" type="text/javascript"></script>

        <!-- Core game -->
        <script type="text/javascript">
            Game = {
                view: {
                    // full-screen
                    width: window.innerWidth,
                    height: window.innerHeight
                },
                start: function() {
                    // Game world is whatever fits on-screen
                    Crafty.init(Game.view.width, Game.view.height);
                    Crafty.background('#008800');
                    map.generate();
                    console.log("Map generated, " + map.locations.length + " Rooms generated");

                    var roomWidth = parseInt(config("roomWidth"));
                    var roomHeight = parseInt(config("roomHeight"));

                    for (var roomIndex = 0; roomIndex < map.locations.length; roomIndex++) {
                        var currentRoom = map.locations[roomIndex];
                        newRoom = Crafty.e("Room")
                            .create(currentRoom.x * roomWidth, currentRoom.y * roomHeight, roomWidth, roomHeight)
                            .setupWalls(currentRoom.openDirections, currentRoom.wallDirections, currentRoom.doorDirections);
                            
                        map.setRoomAt(currentRoom.x, currentRoom.y, newRoom);
                    }
                    Crafty.e("Darkness");
                    var e = Crafty.e("Player");
                }
            }
        </script>
        <script>
            window.addEventListener('load', Game.start);
        </script>
    </head>
    <body></body>
</html>