<!DOCTYPE html>
<html>
	<head>
		<style>
			body {
				margin: 0px;
			}
		</style>

		<script src="lib/crafty-0.7.1.min.js" type="text/javascript"></script>
		<script src="src/prototype/prototype.js" type="text/javascript"></script>

		<script src="src/entities/player.js" type="text/javascript"></script>
		<script src="src/entities/wall.js" type="text/javascript"></script>
		<script src="src/entities/room.js" type="text/javascript"></script>
		<script src="src/entities/map.js" type="text/javascript"></script>
		<script src="src/entities/room-gen.js" type="text/javascript"></script>
		<script src="src/entities/items.js" type="text/javascript"></script>
		<script src="src/entities/darkness.js" type="text/javascript"></script>
    <!-- Core game -->
	<script type="text/javascript">
 	Game = {

    	view: {
					// full-screen
        	width: window.innerWidth,
        	height: window.innerHeight
        },

        start: function() {
					// Game world is whatever fits on-screen
			alert("Start");
        	Crafty.init(Game.view.width, Game.view.height);
			Crafty.background('#008800');
			alert("Making map object");
			map = Crafty.e("Map");
			alert("Generating map");
			map.generate();
			alert("Map generated, "+map.locations.length+" Rooms generated");
					
			//  House: four walls and random internal walls
			// Total exterior size (including walls)
			var houseWidth = parseInt(config("mansion_width"));
			var houseHeight = parseInt(config("mansion_height"));
			for(var roomdraw = 0; roomdraw < map.locations.length;roomdraw++){
				newroom=Crafty.e("Room").create(map.locations[roomdraw].x*300, map.locations[roomdraw].y*300,300,300);
				//Todo: Replace .N,S,E,W attributes with array. Replace below with for loop instead of copy-paste conditionals
						
				if (map.locations[roomdraw].N == 0){newroom.seal("n");}
				else{
					if(map.locations[map.locations[roomdraw].N].Type!=map.locations[roomdraw].Type]){newroom.door("n");}
				}
				if (map.locations[roomdraw].S == 0){newroom.seal("s");}
				else{
					if(map.locations[map.locations[roomdraw].N].Type!=map.locations[roomdraw].Type]){newroom.door("n");}
				}
				if (map.locations[roomdraw].E == 0){newroom.seal("e");}
				else{
					if(map.locations[map.locations[roomdraw].N].Type!=map.locations[roomdraw].Type]){newroom.door("n");}
				}
				if (map.locations[roomdraw].W == 0){newroom.seal("w");}
				else{
					if(map.locations[map.locations[roomdraw].N].Type!=map.locations[roomdraw].Type]){newroom.door("n");}
				}
			}
			Crafty.e("Room").create(0, 0, houseWidth / 2, houseHeight / 2).seal("nw").door("s").lock("s"); // top-left 
			Crafty.e("Room").create(houseWidth / 2, 0, houseWidth / 2, houseHeight / 2).seal("ne").door("w"); // top-right
			Crafty.e("Room").create(0, houseHeight / 2, houseWidth / 2, houseHeight / 2).seal("sw").door("e").addItems(["Key"]); // bottom-left
			Crafty.e("Room").create(houseWidth / 2, houseHeight / 2, houseWidth / 2, houseHeight / 2).seal("se").door("n"); // bottom-right					

			Crafty.e("Darkness");
          
			var e = Crafty.e("Player");
			// Follow player around with camera
			Crafty.viewport.follow(e);
			Crafty.viewport.centerOn(e);
        }
    }
 	</script>
	<script>
	window.addEventListener('load', Game.start);
	</script>
	</head>
	<body>
	</body>
</html>
